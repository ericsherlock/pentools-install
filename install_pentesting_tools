#! /bin/bash

#Usage Message 
usage () {
	echo "Usage: [PROGRAM_NAME]"
}

#Exit Function
exit_func () {

	if [ "$1" -eq 1 ]; then 
		echo "Exit 1 --> Wrong Number of Arguments."
		exit 1
	elif [ "$1" -eq 2 ]; then
		echo "Exit 2 --> Error Within Install Kali Tools Method."
		exit 2
	fi
}

#Install Kali Tools Method
install_pentest_tools () {

	#Create New Directory To Put Tools In, Move To That Directory
	path=$(pwd)	
	echo "Creating directory 'pentesting-tools' in current directory"
	mkdir $path/pentesting-tools && mv rhtoolfile pentesting-tools/ && mv apttoolfile pentesting-tools/ && cd pentesting-tools/

	
	if [ "$1" -eq 1 ]; then

		#While Lines Still In File, Cut Line Into Tool-Name And Install-Command, Execute Install Command, Log Results 
		while read install_cond
		do
			name=$(cut -f1 -d" " <<< $install_cond)
			icon=$(cut -d" " -f3- <<< $install_cond)
			echo "----------------------------------------------------------------------------------------------"
			printf "Installing: %s\n" "$name"	
			echo "----------------------------------------------------------------------------------------------"
			eval "$icon"
			eval_res=$?

			if [ $eval_res -eq 0 ]; then
				printf "%s : Installed Successfully!\n" "$name" >> install_log
				printf "%s Install Successful!\n"
			elif [ $eval_res -ne 0 ]; then
				printf "Error installing : %s\n" "$name" >> install_log
				printf "Try running the command: %s\n" "$icon"
				printf "There was an error installing: %s" "$name"
				printf "Please look in the install_log file to find out more..."
			fi
			
		done < rhtoolfile

	elif [ "$1" -eq 2 ]; then

                #While Lines Still In File, Cut Line Into Tool-Name And Install-Command, Execute Install Command, Log Results 
		while read install_comd
		do
			tool=$(cut -f1 -d" " <<< $install_comd)
			icom=$(cut -d" " -f3- <<< $install_comd)
			echo "----------------------------------------------------------------------------------------------"
			printf "Installing: %s\n" "$name"
			echo "----------------------------------------------------------------------------------------------"
			eval "$icom"
			evalres=$?

                        if [ $evalres -eq 0 ]; then
                                printf "%s : Installed Successfully!\n" "$name" >> install_log
                                printf "%s Install Successful!\n"
                        elif [ $evalres -ne 0 ]; then
                                printf "Error installing : %s\n" "$name" >> install_log
                                printf "Try running the command: %s\n" "$icon"
                                printf "There was an error installing: %s" "$name"
                                printf "Please look in the install_log file to find out more..."
                        fi

		done < apttoolfile
	else
		exit_func 2
	fi
}

#Check For Number Of Arguments, If Correct, Start Installing Tools
if [ "$#" -eq 0 ]; then
	
	#Get Distribution, And Install Files Accordingly
	read -p "Which Repository Do You Use? (d=dnf, a=apt-get): " ans
	case $ans in
		[dD]* )	install_pentest_tools 1
		;; 
		[aA]* )	install_pentest_tools 2
		;;
		* ) echo "Please Enter Either [Dd] or [Aa]"
		;;
	esac
else

	usage
	exit_func 1

fi
